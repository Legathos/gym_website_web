<div class="current-workout-container">
  <!-- Bootstrap Navbar as top bar -->
  <nav class="navbar top-bar">
    <div class="container-fluid">
      <button (click)="goBack()" aria-label="Go back" class="btn btn-back">
        <i class="bi bi-arrow-left"></i>
      </button>
      <h1 class="page-title">Current Workout</h1>
      <div></div> <!-- Empty div for flex spacing -->
    </div>
  </nav>

  <div class="container content-container">
    <!-- Workout name input field -->
    <div class="workout-name-container mb-4">
      <input
        [ngModel]="workoutName"
        (ngModelChange)="updateWorkoutName($event)"
        aria-label="Workout name"
        class="form-control workout-name-input"
        placeholder="Enter workout name"
        type="text">
    </div>

    <!-- Workout exercises list -->
    <div class="workout-exercises-container mb-4">
      <div *ngIf="workoutExercises.length === 0" class="alert alert-info">
        No exercises added yet. Click "Add Exercise" to select exercises from the library.
      </div>

      <div *ngIf="workoutExercises.length > 0" class="exercise-list">
        <h4 class="mb-3">Exercises</h4>
        <div *ngFor="let exercise of workoutExercises" class="card exercise-card mb-3">
          <!-- Exercise top bar with name and delete button -->
          <div class="exercise-top-bar">
            <h5 class="exercise-name">{{ exercise.name }}</h5>
            <button (click)="removeExercise(exercise)" class="btn btn-danger btn-sm delete-btn">
              <i class="bi bi-trash"></i>
            </button>
          </div>
          <div class="card-body">
            <!-- Set tracking section -->
            <div class="sets-container">
              <h6 class="sets-title mb-3">Sets</h6>

              <!-- Sets list -->
              <div *ngIf="(exerciseSets.get(exercise.id) || []).length === 0" class="no-sets-message">
                No sets added yet. Click "Add Set" to start tracking.
              </div>

              <!-- Column headers -->
              <div *ngIf="(exerciseSets.get(exercise.id) || []).length > 0" class="set-headers">
                <div class="set-id-header"></div>
                <div class="weight-header">Weight</div>
                <div class="reps-header">Reps</div>
                <div class="action-header"></div>
              </div>

              <div *ngFor="let set of exerciseSets.get(exercise.id) || []" class="set-row mb-2">
                <div class="set-inputs">
                  <div class="set-id">{{ set.set_id }}</div>
                  <div class="weight-input">
                    <input
                      (ngModelChange)="updateSet(exercise.id, set.set_id, 'weight', $event)"
                      [ngModel]="set.weight"
                      class="form-control"
                      id="weight-{{ exercise.id }}-{{ set.set_id }}"
                      min="0"
                      type="number">
                  </div>

                  <div class="reps-input">
                    <input
                      (ngModelChange)="updateSet(exercise.id, set.set_id, 'reps', $event)"
                      [ngModel]="set.reps"
                      class="form-control"
                      id="reps-{{ exercise.id }}-{{ set.set_id }}"
                      min="0"
                      type="number">
                  </div>

                  <button
                    (click)="deleteSet(exercise.id, set.set_id)"
                    class="btn btn-danger btn-sm delete-set-btn">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>

              <!-- Add Set button -->
              <button
                (click)="addSet(exercise.id)"
                class="btn btn-outline-primary btn-sm add-set-btn mt-2">
                <i class="bi bi-plus-circle me-1"></i> Add Set
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Exercise button -->
    <div class="add-exercise-container mb-4">
      <button (click)="addExercise()" aria-label="Add exercise" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i>Add Exercise
      </button>
    </div>

    <!-- Action buttons -->
    <div class="action-buttons-container">
      <button (click)="finishWorkout()" aria-label="Finish workout" class="btn btn-success">
        Finish Workout
      </button>
      <button (click)="cancelWorkout()" aria-label="Cancel workout" class="btn btn-danger">
        Cancel
      </button>
    </div>
  </div>
</div>
